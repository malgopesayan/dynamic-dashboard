(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{428:(e,t,l)=>{"use strict";l.d(t,{P:()=>o});let o=(0,l(5453).v)(e=>({polygons:[],selectedTime:null,selectedTimeRange:null,selectedPolygonId:null,addPolygon:t=>e(e=>{let l="poly-".concat(Date.now()),o={...t,id:l,name:"Polygon ".concat(e.polygons.length+1),rules:[{id:"1",operator:"<",value:10,color:"blue"},{id:"2",operator:">=",value:10,color:"red"}]};return{polygons:[...e.polygons,o],selectedPolygonId:l}}),updatePolygonData:(t,l)=>e(e=>({polygons:e.polygons.map(e=>e.id===t?{...e,...l}:e)})),deletePolygon:t=>e(e=>({polygons:e.polygons.filter(e=>e.id!==t),selectedPolygonId:e.selectedPolygonId===t?null:e.selectedPolygonId})),setTime:t=>e({selectedTime:t}),setTimeRange:t=>e({selectedTimeRange:t}),setSelectedPolygonId:t=>e({selectedPolygonId:t})}))},2162:(e,t,l)=>{Promise.resolve().then(l.bind(l,8132))},8132:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>j});var o=l(5155),n=l(2115),r=l(5028),i=l(7581);l(1115);var a=l(428),s=l(9796),d=l(3324);let c=()=>{let{selectedTime:e,setTime:t,selectedTimeRange:l,setTimeRange:r}=(0,a.P)(),[c,x]=n.useState(!1);n.useEffect(()=>{e||t(new Date)},[e,t]);let g=new Date;g.setDate(g.getDate()-15),g.setHours(0,0,0,0);let p=e=>Math.round((e.getTime()-g.getTime())/36e5),u=e?p(e):0,h=l?[p(l[0]),p(l[1])]:[u,u+1];return e?(0,o.jsxs)("div",{style:{padding:"20px 40px",background:"#f0f2f5"},children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,o.jsx)("span",{style:{marginRight:8,color:c?void 0:"blue"},children:"Single"}),(0,o.jsx)(d.A,{checked:c,onChange:x}),(0,o.jsx)("span",{style:{marginLeft:8,color:c?"green":void 0},children:"Range"})]}),(0,o.jsx)(s.A,{title:c&&l?l?"".concat(l[0].toLocaleString()," - ").concat(l[1].toLocaleString()):"":e.toLocaleString(),children:(0,o.jsx)(i.A,{min:0,max:719,value:c?h:u,onChange:e=>{if(c&&Array.isArray(e)){let t=new Date(g);t.setHours(g.getHours()+e[0]);let l=new Date(g);l.setHours(g.getHours()+e[1]),r([t,l])}else if(!c&&"number"==typeof e){let l=new Date(g);l.setHours(g.getHours()+e),t(l)}},step:1,range:c})}),(0,o.jsx)("div",{style:{textAlign:"center",marginTop:"10px",fontWeight:"bold",color:c?"green":"blue"},children:c&&l?l?"Selected Range: ".concat(l[0].toLocaleString()," - ").concat(l[1].toLocaleString()):"":"Selected Time: ".concat(e.toLocaleString())})]}):(0,o.jsx)("div",{style:{padding:"20px 40px",background:"#f0f2f5",textAlign:"center"},children:"Initializing timeline..."})};var x=l(8162),g=l(4303),p=l(7270),u=l(3598);let h=()=>{let{polygons:e,selectedPolygonId:t,setSelectedPolygonId:l,deletePolygon:n,updatePolygonData:r}=(0,a.P)(),i=e.find(e=>e.id===t);return(0,o.jsxs)("div",{style:{width:"380px",padding:"20px",borderLeft:"1px solid #e8e8e8",height:"100vh",background:"linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%)",boxShadow:"-2px 0 10px rgba(0,0,0,0.1)",overflowY:"auto"},children:[(0,o.jsx)("div",{style:{textAlign:"center",marginBottom:"25px",padding:"15px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"12px",color:"white",boxShadow:"0 4px 15px rgba(102, 126, 234, 0.3)"},children:(0,o.jsx)("h2",{style:{margin:0,fontSize:"24px",fontWeight:"600"},children:"\uD83C\uDF9B️ Controls"})}),(0,o.jsx)("div",{style:{marginBottom:"25px"},children:e.map(e=>(0,o.jsx)(x.A,{size:"small",title:(0,o.jsx)("span",{style:{fontWeight:"600",color:"#2c3e50"},children:e.name}),style:{marginBottom:"12px",border:e.id===t?"2px solid #667eea":"1px solid #e8e8e8",borderRadius:"10px",boxShadow:e.id===t?"0 4px 15px rgba(102, 126, 234, 0.2)":"0 2px 8px rgba(0,0,0,0.05)",transition:"all 0.3s ease",cursor:"pointer"},onClick:()=>l(e.id),extra:(0,o.jsx)(g.Ay,{type:"text",danger:!0,size:"small",style:{borderRadius:"6px"},onClick:t=>{t.stopPropagation(),n(e.id)},children:"\uD83D\uDDD1️"}),children:"number"==typeof e.currentValue?(0,o.jsx)(p.A,{color:e.color,style:{borderRadius:"6px",fontWeight:"500",fontSize:"12px"},children:"".concat(e.dataSource.field,": ").concat(e.currentValue.toFixed(2))}):(0,o.jsx)(p.A,{style:{borderRadius:"6px",fontWeight:"500",fontSize:"12px",background:"#f0f0f0",color:"#666"},children:"No data"})},e.id))}),(0,o.jsx)("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, #e8e8e8, transparent)",margin:"20px 0"}}),i?(0,o.jsxs)("div",{style:{background:"white",padding:"20px",borderRadius:"12px",boxShadow:"0 4px 15px rgba(0,0,0,0.08)",border:"1px solid #f0f0f0"},children:[(0,o.jsxs)("h3",{style:{margin:"0 0 15px 0",color:"#2c3e50",fontSize:"18px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:["✏️ Edit: ",i.name]}),(0,o.jsx)(u.A,{value:i.name,onChange:e=>r(i.id,{name:e.target.value}),style:{borderRadius:"8px",border:"1px solid #e8e8e8",marginBottom:"20px"},placeholder:"Enter polygon name"}),(0,o.jsx)("h4",{style:{margin:"0 0 15px 0",color:"#2c3e50",fontSize:"16px",fontWeight:"600",display:"flex",alignItems:"center",gap:"8px"},children:"\uD83C\uDFA8 Color Rules:"}),(0,o.jsx)("div",{style:{marginBottom:"15px"},children:i.rules.map(e=>(0,o.jsxs)("div",{style:{marginBottom:"12px",padding:"12px",background:"#f8f9fa",borderRadius:"8px",border:"1px solid #e8e8e8",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,o.jsx)("span",{style:{fontWeight:"500",color:"#2c3e50"},children:"Value ".concat(e.operator," ").concat(e.value," →")}),(0,o.jsx)(p.A,{color:e.color,style:{borderRadius:"6px",fontWeight:"600",fontSize:"12px",minWidth:"60px",textAlign:"center"},children:e.color})]}),(0,o.jsx)(g.Ay,{size:"small",style:{borderRadius:"6px",background:"#2c3e50",border:"none",color:"white",fontWeight:"500"},onClick:()=>{let t=i.rules.map(t=>t.id===e.id?{...t,color:"black"}:t);r(i.id,{rules:t})},children:"Set to Black"})]},e.id))}),(0,o.jsx)(g.Ay,{type:"primary",style:{width:"100%",height:"40px",borderRadius:"8px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",fontWeight:"600",fontSize:"14px",boxShadow:"0 4px 15px rgba(102, 126, 234, 0.3)"},onClick:()=>{let e=i.rules.map(e=>({...e,color:"black"}));r(i.id,{rules:e})},children:"\uD83C\uDFA8 Set All Rules to Black"})]}):(0,o.jsxs)("div",{style:{textAlign:"center",padding:"40px 20px",color:"#666"},children:[(0,o.jsx)("div",{style:{fontSize:"48px",marginBottom:"15px"},children:"\uD83D\uDCCD"}),(0,o.jsx)("div",{style:{fontSize:"16px",fontWeight:"500"},children:"Select or draw a polygon to see details."})]})]})};function f(e){let{children:t,fallback:l=null}=e,[r,i]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{i(!0)},[]),r)?(0,o.jsx)(o.Fragment,{children:t}):(0,o.jsx)(o.Fragment,{children:l})}let y=(e,t)=>{if(void 0===e)return"#808080";for(let l of t)switch(l.operator){case"<":if(e<l.value)return l.color;break;case">":if(e>l.value)return l.color;break;case"<=":if(e<=l.value)return l.color;break;case">=":if(e>=l.value)return l.color;break;case"=":if(e===l.value)return l.color}return"#808080"},m=async(e,t)=>{let{lat:l,lon:o}=(e=>{let t=0,l=0,o=e.length;return e.forEach(e=>{Array.isArray(e)?(t+=e[0],l+=e[1]):(t+=e.lat,l+=e.lng)}),{lat:t/o,lon:l/o}})(e.points),n=t.toISOString().split("T")[0],{url:r,field:i}=e.dataSource,a="".concat(r,"?latitude=").concat(l.toFixed(2),"&longitude=").concat(o.toFixed(2),"&start_date=").concat(n,"&end_date=").concat(n,"&hourly=").concat(i);try{var s,d;let e=await fetch(a);if(!e.ok)throw Error("API Error: ".concat(e.statusText));let l=await e.json(),o=t.getHours(),n=null==l||null==(d=l.hourly)||null==(s=d[i])?void 0:s[o];return"number"==typeof n?n:null}catch(e){return console.error("Failed to fetch Open-Meteo data:",e),null}},b=(0,r.default)(()=>Promise.all([l.e(44),l.e(761),l.e(842),l.e(313)]).then(l.bind(l,8313)),{loadableGenerated:{webpack:()=>[8313]},ssr:!1,loading:()=>(0,o.jsx)("p",{style:{textAlign:"center",flexGrow:1},children:"Loading Map..."})});function j(){let{polygons:e,selectedTime:t,updatePolygonData:l}=(0,a.P)();return(0,n.useEffect)(()=>{let o=async()=>{for(let o of e){let e=await m(o,t),n=y(null===e?void 0:e,o.rules);l(o.id,{currentValue:e,color:n})}};e.length>0&&t&&o()},[t,e,l]),(0,o.jsx)(f,{fallback:(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100vh",justifyContent:"center",alignItems:"center",background:"#f0f2f5"},children:[(0,o.jsx)("h2",{children:"Loading Dashboard..."}),(0,o.jsx)("p",{children:"Please wait while the application initializes."})]}),children:(0,o.jsxs)("main",{style:{display:"flex",flexDirection:"column",height:"100vh"},children:[(0,o.jsx)(c,{}),(0,o.jsxs)("div",{style:{display:"flex",flexGrow:1},children:[(0,o.jsx)("div",{style:{flexGrow:1},children:(0,o.jsx)(b,{})}),(0,o.jsx)(h,{})]})]})})}}},e=>{e.O(0,[466,331,441,964,358],()=>e(e.s=2162)),_N_E=e.O()}]);